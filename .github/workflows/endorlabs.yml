jobs:
  scan-repo:
    permissions:
      id-token: write  # This is required for requesting the JWT
      contents: read  # This is required for actions/checkout
      security-events: write  # This is required to upload SARIF results
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
      
      - name: Endor Labs Scan
        uses: endorlabs/github-action@v1.1.4
        with:
          namespace: ${{ github.event.inputs.tenant_name }}
          scan_summary_output_type: 'table'
          scan_dependencies: true
          scan_secrets: true
          scan_git_logs: true
          pr: false
          sarif_file: 'findings.sarif'
          additional_args: "--as-default-branch --api=${{ github.event.inputs.api }}"
